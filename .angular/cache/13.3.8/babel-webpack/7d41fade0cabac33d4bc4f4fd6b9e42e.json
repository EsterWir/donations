{"ast":null,"code":"import { HttpParams } from '@angular/common/http';\nimport { UohPayLanguage } from '@haifauniversity/ngx-pay';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@ngx-translate/core\";\nimport * as i3 from \"@haifauniversity/ngx-pay\";\nimport * as i4 from \"~shared/services/user-info/user-info-store.service\";\nimport * as i5 from \"~shared/services/payment/payment-store.service\";\nimport * as i6 from \"@angular/common\";\n\nfunction PaymentPageComponent_uoh_pay_page_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"uoh-pay-page\", 1);\n    i0.ɵɵlistener(\"paid\", function PaymentPageComponent_uoh_pay_page_0_Template_uoh_pay_page_paid_0_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return ctx_r1.onPaid($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"url\", ctx_r0.url)(\"token\", ctx_r0.token);\n  }\n}\n\nexport let PaymentPageComponent = /*#__PURE__*/(() => {\n  class PaymentPageComponent {\n    constructor(router, translate, urlBuilder, userInfo, paymentStore) {\n      this.router = router;\n      this.translate = translate;\n      this.urlBuilder = urlBuilder;\n      this.userInfo = userInfo;\n      this.paymentStore = paymentStore;\n      this.url = \"\";\n    }\n\n    ngOnInit() {\n      const {\n        terminal\n      } = this.paymentStore.getCheckoutData() || {};\n\n      if (terminal) {\n        this.url = this.urlBuilder.build(terminal, this.params, this.extraParams);\n      }\n    }\n\n    onPaid(success) {\n      this.router.navigate([success ? 'confirmation' : 'failure']);\n    }\n\n    get token() {\n      var _a;\n\n      return ((_a = this.paymentStore.getCheckoutData()) === null || _a === void 0 ? void 0 : _a.token) || null;\n    }\n\n    get extraParams() {\n      const extraParams = new HttpParams();\n      const formData = this.paymentStore.getFormData();\n\n      if (formData) {\n        console.log(formData.coursess);\n        return extraParams.set('remarks', formData.remarks || '').set('phone', formData.phone).set('discountCode', formData.discountCode || '').set('coursess', formData.coursess.map(i => i.description).join(', '));\n      }\n\n      return extraParams;\n    }\n\n    get params() {\n      const locale = this.translate.currentLang;\n      const {\n        token,\n        sum,\n        payType,\n        currency,\n        maxInstallments\n      } = this.paymentStore.getCheckoutData() || {};\n\n      if (!sum || !token) {\n        throw new Error('Checkout data not available');\n      }\n\n      return {\n        token,\n        sum,\n        currency,\n        maxInstallments,\n        type: payType,\n        customer: this.customer,\n        product: this.product,\n        language: locale === 'he' ? UohPayLanguage.Hebrew : UohPayLanguage.English\n      };\n    }\n\n    get product() {\n      const {\n        code,\n        description\n      } = this.paymentStore.getProductData() || {};\n\n      if (!code || !description) {\n        throw new Error('Product data not available');\n      }\n\n      return {\n        code,\n        description\n      };\n    }\n\n    get customer() {\n      const {\n        id,\n        firstName,\n        lastName,\n        email\n      } = this.userInfo;\n      const formData = this.paymentStore.getFormData();\n      return {\n        id,\n        email: (formData === null || formData === void 0 ? void 0 : formData.email) || email,\n        firstName: (formData === null || formData === void 0 ? void 0 : formData.firstName) || firstName,\n        lastName: (formData === null || formData === void 0 ? void 0 : formData.lastName) || lastName\n      };\n    }\n\n  }\n\n  PaymentPageComponent.ɵfac = function PaymentPageComponent_Factory(t) {\n    return new (t || PaymentPageComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.TranslateService), i0.ɵɵdirectiveInject(i3.UohPayUrlBuilder), i0.ɵɵdirectiveInject(i4.UserInfoStoreService), i0.ɵɵdirectiveInject(i5.PaymentStoreService));\n  };\n\n  PaymentPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PaymentPageComponent,\n    selectors: [[\"ng-component\"]],\n    decls: 1,\n    vars: 1,\n    consts: [[3, \"url\", \"token\", \"paid\", 4, \"ngIf\"], [3, \"url\", \"token\", \"paid\"]],\n    template: function PaymentPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, PaymentPageComponent_uoh_pay_page_0_Template, 1, 2, \"uoh-pay-page\", 0);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", !!ctx.token);\n      }\n    },\n    directives: [i6.NgIf, i3.UohPayPageComponent],\n    styles: [\"\"]\n  });\n  return PaymentPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}